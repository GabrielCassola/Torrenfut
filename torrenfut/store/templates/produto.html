{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ camiseta.time }} {{ camiseta.estilo }} {{ camiseta.temporada }}</title>
    <link rel="stylesheet" href="{% static 'store/produto.css' %}">
</head>
<body>
    <div class="container">
        <!-- Imagem da camisa -->
        <img src="{{ camiseta.imagem.url }}" alt="{{ camiseta.time }} {{ camiseta.estilo }}" />
        
        <!-- Informações do produto -->
        <div class="product-info">
            <h1>{{ camiseta.time }} {{ camiseta.estilo }} {{ camiseta.temporada }}</h1>
            <p class="price">Preço: R${{ camiseta.valor_final|floatformat:2 }}</p>

            <!-- Botões de seleção de tamanhos -->
            <h3>Escolha o tamanho:</h3>
            <div class="btn-group">
                {% for tamanho in tamanhos %}
                    <button type="button"
                            class="btn-tamanho {% if tamanho.quantidade_em_estoque == 0 %}btn-desabilitado{% endif %}"
                            onclick="exibirEstoque('{{ tamanho.tamanho }}', '{{ tamanho.quantidade_em_estoque }}', '{{ tamanho.id }}')"
                            {% if tamanho.quantidade_em_estoque == 0 %}disabled{% endif %}>
                        {{ tamanho.tamanho }}
                    </button>
                {% endfor %}
            </div>

            <!-- Exibição da quantidade de estoque -->
            <div class="stock-info">
                <h4>Quantidade em estoque: <span id="estoque">Selecione um tamanho</span></h4>
            </div>

            <!-- Formulário para adicionar ao carrinho -->
            <form action="{% url 'adicionar_ao_carrinho' camiseta.id %}" method="POST" id="formCarrinho">
                {% csrf_token %}
                <input type="hidden" name="tamanho_id" id="tamanho_id" value="">
                <button type="submit" class="btn-comprar" disabled id="btnComprar" onclick="this.disabled=true; this.form.submit();">Adicionar ao Carrinho</button>
            </form>            
        </div>
    </div>
    <p>Voltar para <a href="/store">página inicial</a></p>

    <script>
        const buttons = document.querySelectorAll('.btn-tamanho');
        const btnComprar = document.getElementById('btnComprar');
        const tamanhoInput = document.getElementById('tamanho_id');

        function exibirEstoque(tamanho, quantidade, tamanho_id) {
            document.getElementById('estoque').textContent = quantidade;
            tamanhoInput.value = tamanho_id;

            // Habilita o botão de compra se houver estoque
            btnComprar.disabled = quantidade == 0;
        }

        buttons.forEach(button => {
            button.addEventListener('click', function(){
                buttons.forEach(btn => btn.classList.remove('selected'));
                this.classList.add('selected')
            })
        });

    </script>
</body>
</html>
