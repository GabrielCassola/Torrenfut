{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torrenfut</title>
    <link rel="stylesheet" href="{% static 'store/home.css' %}">
</head>
<body>
    <h1 style="text-align: center;">Torrenfut</h1>

    <!-- Botões de login e cadastro, ou exibe o nome do usuário logado -->
    <div style="text-align: right; margin-bottom: 20px;">
        {% if user.is_authenticated %}
            <!-- Exibe o ícone do usuário com um link para o perfil -->
            <a href="{% url 'perfil' %}" style="text-decoration: none; color: black;">
            <span>{{ user.first_name }} {{ user.last_name }}</span>
            </a>

            <!-- Botão para ir ao carrinho -->
            <a href="{% url 'ver_carrinho' %}" class="button" style="margin-left: 15px;">Ir para o Carrinho</a>
        {% else %}
            <a href="{% url 'login' %}" class="button">Login</a>
            <a href="{% url 'cadastro' %}" class="button">Cadastro</a>
        {% endif %}
    </div>

    <div class="buscar">
        <input id="inputBusca" onkeyup="filtrar()" type="text" placeholder="O que você procura?">
    </div>
    <div class="listaProdutosContainer">
        <ul id="listaProdutos">
            {% for camiseta in camisetas %}
                <li>
                    <a href="{% url 'produto' time=camiseta.time estilo=camiseta.estilo temporada=camiseta.temporada|urlencode %}">
                        <img src="{{ camiseta.imagem.url }}" alt="{{ camiseta.time }}" width="100%">
                    </a><span class="item-text">{{ camiseta.time }} {{ camiseta.estilo }} {{ camiseta.temporada }}</span>
                    </a>
                </li>
            {% endfor %}
        </ul>
    </div>
    
    <script>
        function filtrar() {
            var input, filter, ul, li, span, i, txtValue, count = 0;
    
            // Obter valor de pesquisa e os elementos
            input = document.getElementById('inputBusca');
            ul = document.getElementById('listaProdutos');
            filter = input.value.toUpperCase();
    
            // Pegar todos os <li> dentro do <ul>
            li = ul.getElementsByTagName("li");
    
            // Se o campo estiver vazio, ocultar todos os itens
            if (filter === "") {
                ul.style.display = "none";
                for (i = 0; i < li.length; i++) {
                    li[i].style.display = "none";
                }
                return; // Sai da função se o campo estiver vazio
            }
    
            // Percorrer os <li> para verificar quais correspondem ao filtro
            for (i = 0; i < li.length; i++) {
                span = li[i].getElementsByClassName("item-text")[0]; // Seleciona o texto do item
                txtValue = span.textContent || span.innerText;
    
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    li[i].style.display = ""; // Mostra o item se corresponder
                    count++;
    
                    // Destaque em negrito a parte correspondente
                    let regex = new RegExp(`(${filter})`, 'gi');
                    span.innerHTML = txtValue.replace(regex, "<strong>$1</strong>");
                } else {
                    li[i].style.display = "none"; // Esconde o item se não corresponder
                }
            }
    
            // Exibir ou ocultar a lista dependendo do número de correspondências
            ul.style.display = count === 0 ? "none" : "block";
        }
    </script>
    
    <div class="container">
        <div class="filters">
            <form method="get" action="{% url 'filtrar_camisetas' %}">
                <ul>
                    <li>
                        <label for="tipo_produto">Produto:</label>
                        <select name="tipo_produto" id="tipo_produto">
                            <option value="">Selecione um tipo de produto</option>
                            {% for tipo in tipos_produto_disponiveis %}
                                <option value="{{ tipo.id }}">{{ tipo }}</option>
                            {% endfor %}
                        </select>
                    </li>
                    <li>
                        <label for="time">Time:</label>
                        <select name="time" id="time">
                            <option value="">Selecione um time</option>
                            {% for time in times_disponiveis %}
                                <option value="{{ time }}">{{ time }}</option>
                            {% endfor %}
                        </select>
                    </li>
                    <li>
                        <label for="marca">Marca:</label>
                        <select name="marca" id="marca">
                            <option value="">Selecione uma marca</option>
                            {% for marca in marcas_disponiveis %}
                                <option value="{{ marca }}">{{ marca }}</option>
                            {% endfor %}
                        </select>
                    </li>
                    <li>
                        <label for="cor">Cor:</label>
                        <select name="cor" id="cor">
                            <option value="">Selecione uma cor</option>
                            {% for cor in cores_disponiveis %}
                                <option value="{{ cor }}">{{ cor }}</option>
                            {% endfor %}
                        </select>
                    </li>
                    <li>
                        <label for="temporada">Temporada:</label>
                        <select name="temporada" id="temporada">
                            <option value="">Selecione uma temporada</option>
                            {% for temporada in temporadas_disponiveis %}
                                <option value="{{ temporada }}">{{ temporada }}</option>
                            {% endfor %}
                        </select>
                    </li>
                </ul>
                <button type="submit">Filtrar</button>
            </form>
        </div>
    
        <ul class="gallery">
            {% for camiseta in camisetas %}
                <li>
                    <a href="{% url 'produto' time=camiseta.time estilo=camiseta.estilo temporada=camiseta.temporada|urlencode %}">
                    <img src="{{ camiseta.imagem.url }}" alt="{{ camiseta.time }}" width="100%"></a>
                    <br>
                    <a class="link" href="{% url 'produto' time=camiseta.time estilo=camiseta.estilo temporada=camiseta.temporada|urlencode %}">
                        {{ camiseta.time }} {{ camiseta.estilo }} {{ camiseta.temporada }}
                    </a>
                    <span class="preço">R$ {{ camiseta.valor_final|floatformat:2 }}</span>
                </li>
            {% endfor %}
        </ul>
    </div>

    
    <footer>
        <!-- Linha divisória horizontal -->
        <hr class="footer-divider">
        
        <!-- Conteúdo do rodapé -->
        <div class="footer-content">
            <!-- Lado esquerdo -->
            <div class="footer-left">
                <a href="{% url 'sobre' %}" class="button">Sobre o Projeto</a>
                <a href="{% url 'quem_somos' %}" class="button">Quem Somos Nós</a>
            </div>
            
            <!-- Lado direito -->
            <div class="footer-right">
                <a href="https://github.com/GabrielCassola/Torrenfut" target="_blank" class="button">GitHub</a>
            </div>
        </div>
    </footer>

    
</body>
</html>
